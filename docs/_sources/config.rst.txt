.. role:: raw-html(raw)
   :format: html


Configuration
=============

To run a filetransfer two configurations (application and job) are
needed. Both are INI-style files.

In the tables below strings in single quotes must be given literally
(case insensitive) and without the quotes.

See: example :ref:`ref-configuration-files`


Application Configuration
-------------------------

This configuration contains some global properties. It is the file
that is set with the ``--config`` option or the ``FILETRANSFER_CFG``
environment variable (see: :doc:`usage`).

.. table::
   :class: cfgtable
   :widths: auto

   +---------------+------------------------------------------------------------------+
   | **[global]**  | directory for job configurations and hosts config                |
   +---------------+------------------------------------+-----------------------------+
   | ``jobs_dir``  | path to directory with job configs | required                    |
   +---------------+------------------------------------+-----------------------------+
   | ``hosts_cfg`` | path to hosts configuration file   | see: `Hosts Configuration`_ |
   +---------------+------------------------------------+-----------------------------+

.. table::
   :class: cfgtable
   :widths: auto

   +-----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **[logging]**   | logging configuration (optional)                                                                                                                                                            |
   +-----------------+--------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
   | ``log_dir``     | path to base directory for log files                               | if not set the logging messages will go to STDERR                                                                      |
   +-----------------+--------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
   | ``use_subdirs`` | :raw-html:`<span style="white-space: nowrap;">'yes' | 'no'</span>` | | yes (default): the logfile will be named :file:`{timestamp}.log` and placed in a sub directory named :file:`{jobid}` |
   |                 |                                                                    | | no: the logfile will be named :file:`{jobid}_{timestamp}.log` and placed directly in the ``log_dir`` directory       |
   +-----------------+--------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
   | ``msg_format``  | format string                                                      | | default: ``%(asctime)s %(levelname)-8s %(message)s``                                                                 |
   |                 |                                                                    | | see: `LogRecord attributes <https://docs.python.org/3/library/logging.html#logrecord-attributes>`_                   |
   +-----------------+--------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
   | ``log_level``   | log level (string or number)                                       | | default: ``INFO``                                                                                                    |
   |                 |                                                                    | | see: `Logging Levels <https://docs.python.org/3/library/logging.html#logging-levels>`_                               |
   +-----------------+--------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+

.. table::
   :class: cfgtable
   :widths: auto

   +------------------+------------------------------------------------------------------------------------------------------------------+
   | **[sftp]**       | known_hosts file and private key files for SFTP (optional)                                                       |
   +------------------+-------------------------------+----------------------------------------------------------------------------------+
   | ``key_rsa_file`` | path to RSA private key file  | required if SFTP is used and ``key_file`` is set to 'RSA' in a job configuration |
   +------------------+-------------------------------+----------------------------------------------------------------------------------+
   | ``key_rsa_pass`` | password for ``key_rsa_file`` | required if ``key_rsa_file`` is password protected                               |
   +------------------+-------------------------------+----------------------------------------------------------------------------------+
   | ``key_dsa_file`` | path to DSA private key file  | required if SFTP is used and ``key_file`` is set to 'DSA' in a job configuration |
   +------------------+-------------------------------+----------------------------------------------------------------------------------+
   | ``key_dsa_pass`` | password for ``key_dsa_file`` | required if ``key_dsa_file`` is password protected                               |
   +------------------+-------------------------------+----------------------------------------------------------------------------------+
   | ``known_hosts``  | path to known_hosts file      | required if SFTP is used and ``known_hosts`` is not set in a job configuration   |
   +------------------+-------------------------------+----------------------------------------------------------------------------------+

.. table::
   :class: cfgtable
   :widths: auto

   +--------------+-------------------------------------------------------------------------------------------------------------+
   | **[mail]**   | SMTP server for sending notifications (optional)                                                            |
   +--------------+------------------------------------------------------------------------------+------------------------------+
   | ``host``     | :raw-html:`<span style="white-space: nowrap;">(dns-name | ip)[:port]</span>` | required                     |
   +--------------+------------------------------------------------------------------------------+------------------------------+
   | ``security`` | :raw-html:`<span style="white-space: nowrap;">'starttls' | 'tls' </span>`    | default: insecure connection |
   +--------------+------------------------------------------------------------------------------+------------------------------+
   | ``user``     | username                                                                     | required                     |
   +--------------+------------------------------------------------------------------------------+------------------------------+
   | ``password`` | password                                                                     | required                     |
   +--------------+------------------------------------------------------------------------------+------------------------------+
   | ``from``     | from email address                                                           | required                     |
   +--------------+------------------------------------------------------------------------------+------------------------------+

.. table::
   :class: cfgtable
   :widths: auto

   +--------------+---------------------------------------------------------------------------------------+
   | **[notify]** | email addresses of receipients who should be notified about all jobs (optional)       |
   +--------------+-----------------------------------------+---------------------------------------------+
   | ``success``  | comma separated list of email addresses | receipients to notify if the job succeeded  |
   +--------------+-----------------------------------------+---------------------------------------------+
   | ``error``    | comma separated list of email addresses | receipients to notify if there was an error |
   +--------------+-----------------------------------------+---------------------------------------------+
   | ``done``     | comma separated list of email addresses | receipients to notify in both cases         |
   +--------------+-----------------------------------------+---------------------------------------------+


.. _ref-job-configuration:

Job Configuration
-----------------

A job configuration file must have a name of the form :file:`{JOB_ID}.cfg`
(e.g. ``job001.cfg`` where ``job001`` is the job id) and it must be
saved in the ``jobs_dir`` directory as defined in the application configuration.

.. table::
   :class: cfgtable
   :widths: auto

   +------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **[source]**     | definition of the source                                                                                                                                                                                 |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``host_id``      | host id                                                                                 | | see: `Hosts Configuration`_                                                                                  |
   |                  |                                                                                         | | It is an error if any possible host configuration setting is set in this section when ``host_id`` is used.   |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``type``         | :raw-html:`<span style="white-space: nowrap;">'local' | 'ftp' | 'ftps' | 'sftp'</span>` | required                                                                                                       |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``host``         | :raw-html:`<span style="white-space: nowrap;">(dns-name | ip)[:port]</span>`            | required for FTP, FTPS, SFTP                                                                                   |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``user``         | username                                                                                | required for FTP, FTPS, SFTP                                                                                   |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``password``     | password                                                                                | optional for FTP, FTPS, SFTP (SFTP: ignored when ``key_file`` is used)                                         |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``timeout``      | timeout in seconds                                                                      | optional for FTP, FTPS, SFTP; default: 0.0 = no timeout                                                        |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``passive_mode`` | :raw-html:`<span style="white-space: nowrap;">'yes' | 'no'</span>`                      | optional for FTP, FTPS; default: yes                                                                           |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``encrypt_data`` | :raw-html:`<span style="white-space: nowrap;">'yes' | 'no'</span>`                      | optional for FTPS; default: yes                                                                                |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``key_file``     | path to private key file | 'RSA' | 'DSA'                                                | optional for SFTP ('RSA' / 'DSA' refer to the keyfiles in the [sftp] section of the application configuration) |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``key_pass``     | password for ``key_file``                                                               | optional for SFTP (not used if 'RSA' or 'DSA' is used for ``key_file``)                                        |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``known_hosts``  | path to known_hosts file                                                                | required for SFTP if not set in the application configuration                                                  |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``path``         | path to source directory                                                                | required                                                                                                       |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``files``        | one or more filepatterns                                                                | required (UNIX shell-style wildcards pattern)                                                                  |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``ignore``       | one or more filepatterns                                                                | default: .* (UNIX shell-style wildcards pattern)                                                               |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``recursive``    | :raw-html:`<span style="white-space: nowrap;">'yes' | 'no'</span>`                      | default: no                                                                                                    |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``delete``       | :raw-html:`<span style="white-space: nowrap;">'yes' | 'no'</span>`                      | default: no                                                                                                    |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+

.. table::
   :class: cfgtable
   :widths: auto

   +------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **[target]**     | definition of the target                                                                                                                                                                                 |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``host_id``      | host id                                                                                 | | see: `Hosts Configuration`_                                                                                  |
   |                  |                                                                                         | | It is an error if any possible host configuration setting is set in this section when ``host_id`` is used.   |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``type``         | :raw-html:`<span style="white-space: nowrap;">'local' | 'ftp' | 'ftps' | 'sftp'</span>` | required                                                                                                       |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``host``         | :raw-html:`<span style="white-space: nowrap;">(dns-name | ip)[:port]</span>`            | required for FTP, FTPS, SFTP                                                                                   |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``user``         | username                                                                                | required for FTP, FTPS, SFTP                                                                                   |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``password``     | password                                                                                | optional for FTP, FTPS, SFTP (SFTP: ignored when ``key_file`` is used)                                         |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``timeout``      | timeout in seconds                                                                      | optional for FTP, FTPS, SFTP; default: 0.0 = no timeout                                                        |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``passive_mode`` | :raw-html:`<span style="white-space: nowrap;">'yes' | 'no'</span>`                      | optional for FTP, FTPS; default: yes                                                                           |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``encrypt_data`` | :raw-html:`<span style="white-space: nowrap;">'yes' | 'no'</span>`                      | optional for FTPS; default: yes                                                                                |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``key_file``     | path to private key file | 'RSA' | 'DSA'                                                | optional for SFTP ('RSA' / 'DSA' refer to the keyfiles in the [sftp] section of the application configuration) |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``key_pass``     | password for ``key_file``                                                               | optional for SFTP (not used if 'RSA' or 'DSA' is used for ``key_file``)                                        |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``known_hosts``  | path to known_hosts file                                                                | required for SFTP if not set in the application configuration                                                  |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``path``         | path to target directory                                                                | required                                                                                                       |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``temp``         | :raw-html:`<span style="white-space: nowrap;">'dot' | 'ext:'.ext | 'dir:'subdir</span>` | default: no temporary files are used                                                                           |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+

.. table::
   :class: cfgtable
   :widths: auto

   +--------------+---------------------------------------------------------------------------------------+
   | **[notify]** | email addresses of receipients who should be notified about this job (optional)       |
   +--------------+-----------------------------------------+---------------------------------------------+
   | ``name``     | job name to show in the email           | default: job id                             |
   +--------------+-----------------------------------------+---------------------------------------------+
   | ``success``  | comma separated list of email addresses | receipients to notify if the job succeeded  |
   +--------------+-----------------------------------------+---------------------------------------------+
   | ``error``    | comma separated list of email addresses | receipients to notify if there was an error |
   +--------------+-----------------------------------------+---------------------------------------------+
   | ``done``     | comma separated list of email addresses | receipients to notify in both cases         |
   +--------------+-----------------------------------------+---------------------------------------------+


Hosts Configuration
-------------------

A hosts configuration contains sections which each define a configuration of
a host like in the ``[source]`` and ``[target]`` sections of a job
configuration. Such a host configuration can be referenced by setting the
``host_id`` in those sections to the section name of a host configuration.

.. table::
   :class: cfgtable
   :widths: auto

   +------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | **[{host_id}]**  | host configuration                                                                                                                                                                                       |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``type``         | :raw-html:`<span style="white-space: nowrap;">'local' | 'ftp' | 'ftps' | 'sftp'</span>` | required                                                                                                       |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``host``         | :raw-html:`<span style="white-space: nowrap;">(dns-name | ip)[:port]</span>`            | required for FTP, FTPS, SFTP                                                                                   |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``user``         | username                                                                                | required for FTP, FTPS, SFTP                                                                                   |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``password``     | password                                                                                | optional for FTP, FTPS, SFTP (SFTP: ignored when ``key_file`` is used)                                         |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``timeout``      | timeout in seconds                                                                      | optional for FTP, FTPS, SFTP; default: 0.0 = no timeout                                                        |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``passive_mode`` | :raw-html:`<span style="white-space: nowrap;">'yes' | 'no'</span>`                      | optional for FTP, FTPS; default: yes                                                                           |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``encrypt_data`` | :raw-html:`<span style="white-space: nowrap;">'yes' | 'no'</span>`                      | optional for FTPS; default: yes                                                                                |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``key_file``     | path to private key file | 'RSA' | 'DSA'                                                | optional for SFTP ('RSA' / 'DSA' refer to the keyfiles in the [sftp] section of the application configuration) |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``key_pass``     | password for ``key_file``                                                               | optional for SFTP (not used if 'RSA' or 'DSA' is used for ``key_file``)                                        |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
   | ``known_hosts``  | path to known_hosts file                                                                | required for SFTP if not set in the application configuration                                                  |
   +------------------+-----------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------+
